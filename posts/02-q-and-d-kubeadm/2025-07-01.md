---
abstract: Demonstrate a quick and dirty deployment with kubeadm.
author: Xander Harris
blogpost: true
category: Quick and Dirty
date: 2025-07-01
tags: kubeadm, q&d
title: Quick and Dirty control plane with kubeadm
---

For this demonstration we will be using {term}`kubeadm` to deploy and configure
a control plane node which is the Lenovo ThinkCentre M910q that was acquired
for this purpose.

## Q&D Control Plane Requirements

The remainder of this guide assumes the presence of an {term}`ArchLinux` system
on a locally-accessible network that accepts {term}`ssh` connections from a non-root
user with {term}`sudo` access to the system in question, which should also
have a functional installation of {term}`yay`.

## Prepare for kubeadm

In the interests of keeping things in relatively standard locations, all of the
configuration files used by {term}`kubeadm` will be kept in {file}`/etc/kubeadm`,
which we can create now.

```{code-block} shell
:caption: Create the {term}`kubeadm` configuration directory

ssh kcp01
sudo su -
mkdir /etc/kubeadm
```

:::{note}
The remainder of this guide assumes that the commands listed above have been
successfully executed, so far you should have:

1. ```{code-block} shell
   :caption: created an {term}`ssh` connection
   ssh kcp01
   ```

2. ```{code-block} shell
   :caption: installed {term}`kubelet` and {term}`kubeadm` with yay
   yay -S kubelet kubeadm
   ```

3. ```{code-block} shell
   :caption: used {term}`sudo` to become the root user
   sudo su -
   ```

4. ```{code-block} shell
   :caption: enabled the {term}`kubelet` service
   systemctl enable --now kubelet
   ```

   ```{tip}
   It is safe to ignore any errors that the command above may throw, they
   will be resolved by {term}`kubeadm` later.
   ```

5. ```{code-block} shell
   :caption: created the {term}`kubeadm` configuration directory
   mkdir -pv /etc/kubeadm
   ```

6. ```{code-block} shell
   :caption: updated your working directory
   cd /etc/kubeadm
   ```

:::

### Create an initial configuration

While it is possible to write a {term}`kubeadm` initial configuration file
from scratch, you are much better off letting {term}`kubeadm` do that for you.

```{code-block} shell
:caption: create default {term}`kubeadm` init configuration
kubeadm config print init-defaults > init.yaml
```

This should leave you with something similar to the output below:

```{code-block} shell
[root@kcp01:/etc/kubeadm]{0} # ls -l
total 4
-rw-r--r-- 1 root root 1139 Jun 29 18:53 init.yaml
```

```{code-block} yaml
:caption: default init.yml
:linenos:

apiVersion: kubeadm.k8s.io/v1beta4
bootstrapTokens:
- groups:
  - system:bootstrappers:kubeadm:default-node-token
  token: abcdef.0123456789abcdef
  ttl: 24h0m0s
  usages:
  - signing
  - authentication
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: 1.2.3.4
  bindPort: 6443
nodeRegistration:
  criSocket: unix:///var/run/containerd/containerd.sock
  imagePullPolicy: IfNotPresent
  imagePullSerial: true
  name: node
  taints: null
timeouts:
  controlPlaneComponentHealthCheck: 4m0s
  discovery: 5m0s
  etcdAPICall: 2m0s
  kubeletHealthCheck: 4m0s
  kubernetesAPICall: 1m0s
  tlsBootstrap: 5m0s
  upgradeManifests: 5m0s
---
apiServer: {}
apiVersion: kubeadm.k8s.io/v1beta4
caCertificateValidityPeriod: 87600h0m0s
certificateValidityPeriod: 8760h0m0s
certificatesDir: /etc/kubernetes/pki
clusterName: kubernetes
controllerManager: {}
dns: {}
encryptionAlgorithm: RSA-2048
etcd:
  local:
    dataDir: /var/lib/etcd
imageRepository: registry.k8s.io
kind: ClusterConfiguration
kubernetesVersion: 1.33.0
networking:
  dnsDomain: cluster.local
  serviceSubnet: 10.96.0.0/12
proxy: {}
scheduler: {}
```

Most of the default values are acceptable, but a number of them will need
to be updated.

## Configure and initialize the control plane

```{sectionauthor} Xander Harris <xandertheharris@gmail.com>
```
